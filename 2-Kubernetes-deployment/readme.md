**Предыстория**

Весной этого года поднял свой Kubernetes на базе k3s на одном сервере.

Нужно было для незавимой работы над небольшим проектом с коллегой.

Подняты:
1. Docker registry - для самостоятельного хранения докеров, без докерхаба
2. Gitea - для работы с кодом
3. Drone - для автоматизации развертывания

Вместо штатного ingress контроллера traefik был установлен Nginx. Замена была обусловлена необходимостью пробрасывать 22 порт к Gitea.

Наличие и понимание Kubernetes было, поэтому для решения задачи использовал его. В процессе узнал новое.

# Развертывание в Kubernetes
0.configMap.yaml - рабочий конфиг для bingo. Затем используется в 1.deploy.yaml.

1.deploy.yaml - развертывание pods (контейнеров с bingo). Здесь отказоустойчивость, монтирование конфига из ConfigMap и монтирование /tmp хоста к папке логов. Докер образ скачивается из собственного docker registry.

2.service.yaml - сервис - объединение узлов в кластер, локальная маршрутизация

3.ingress-no-cache.yaml - организация входящего трафика снаружи, поддомена и ssl сертификата.

3.ingress-cache.yaml - дополнительный Ingress для целей кеширования long_dummy.

4.network-policy-block-google.yaml - ограничение исходящего трафика для нод bingo

5.add-to-configmap-nginx-ingress-controller-for-cache.yaml - добавки, сделанные в настройках ConfigMap Nginx Ingress контроллера для организации кеширования.

Нюансы смотрите в комментариях внутри yaml файлов.

